---
layout: post
title: Comparing Code Coverage of Randoop and EvoSuite using EclEmma and JD-Eclipse
date: '2013-04-15T01:38:00.003-04:00'
author: Brett Koenig
tags:
- EclEmma
- JUnit
- Randoop
- Eclipse
- EvoSuite
modified_time: '2013-04-15T01:38:42.333-04:00'
thumbnail: http://4.bp.blogspot.com/-6E2AuJd-J78/UWuIVqTkMvI/AAAAAAAAAZc/tImw7xWBdDg/s72-c/FullSS.png
---

Once again I am working with&nbsp;<a href="https://code.google.com/p/randoop/">Randoop</a>&nbsp;and <a href="http://www.evosuite.org/">EvoSuite</a>. &nbsp;I need to compare the branch coverage of the test suites generated by each tool. &nbsp;Also in some cases I don't have the original source code of the Java JAR that I am generating tests on. &nbsp;So that will add another layer of complexity on top of it. &nbsp;Anywho, here is the process I used to get everything to work.<br /><div><a name='more'></a><br /></div><h2>Set Up Eclipse</h2><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-6E2AuJd-J78/UWuIVqTkMvI/AAAAAAAAAZc/tImw7xWBdDg/s1600/FullSS.png" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" height="640" src="http://4.bp.blogspot.com/-6E2AuJd-J78/UWuIVqTkMvI/AAAAAAAAAZc/tImw7xWBdDg/s640/FullSS.png" width="160" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Screen shot of my final project structure.</td></tr></tbody></table><div>The first thing you need to do is make sure you have <a href="http://www.eclemma.org/">EclEmma</a> and <a href="http://java.decompiler.free.fr/?q=jdeclipse">JD-Eclipse</a> installed. &nbsp;I ran into a little trouble decompiling .class files with JD-Eclipse at first because there isn't good documentation for how to actually use it once it is installed. &nbsp;The first thing you need to do is to make sure that the class files are on your build path. &nbsp;To do this I just did <b>new-&gt;source folder</b>. Then I made sure that the within that folder I had the proper folder structure for my class. &nbsp;In this instance the class file was part of the "example.tritype2" package so I needed to make sure that the directory structure was <b>example/tritype2/</b>. &nbsp;Then in that folder I put my class file.</div><div><br /></div><div>From there you should be able to double click on it using the <b>Navigation</b>&nbsp;view and see a decompiled Java program. &nbsp;If not try right clicking on the file and selecting <b>Open With-&gt;Class File Editor</b>. &nbsp;If that doesn't work for you, then I am afraid I can't be of much help because I am new to using the tool myself.</div><div><br /></div><div>Now that you have JD-Eclipse working you can right click on your project and go to&nbsp;<b>New-&gt;Package</b>. Create the package(s) that correspond to each class file in the JAR that you need to run coverage analysis on. &nbsp;Then for each class file create new empty Java class in the appropriate package. &nbsp;Finally just open the class file and copy and paste the decompiled Java into the java file.</div><div><br /></div><div>Next you need to add two new source folders. &nbsp;one for EvoSuite tests and the other for Randoop tests. &nbsp;Then copy your EvoSuite test folder into the corresponding Eclipse source folder. &nbsp;From there you need to do something similar with Randoop tests, but since they aren't in a nice directory structure like EvoSuite you can just copy all the tests directly into the randoop tests source folder.<br /><br /><div style="clear: both;"></div><h2>Fix EvoSuite Tests</h2>You will need to do is to edit the EvoSuite test becuase it will have an error. &nbsp;You need to remove 3 lines. &nbsp;First remove from the imports section<br /><pre class="brush: java;" name="code">import org.junit.runner.RunWith;<br />import org.evosuite.junit.EvoSuiteRunner;<br /></pre><br />Then from right above the class header remove the following annotation. <br /><pre class="brush: java;" name="code">@RunWith(EvoSuiteRunner.class)<br /></pre><br />I originally put EvoSuite on my classpath to get the errors to go away but that caused problems when I tried to get coverage. &nbsp;I found that by just removing them it fixed everything.</div><div style="clear: both;"></div><h2>Set Up Coverage Runs</h2><div>The next thing I did was create coverage runs to make it easier to quickly run each and not get confused. &nbsp;For the first one right click on the EvoSuite test folder and go to <b>Coverage As -&gt; Coverage Configuration</b>. &nbsp;Then in the JUnit section edit the <b>Test</b>&nbsp;area so that it runs all of the tests in that folder. &nbsp;In the <b>Coverage</b>&nbsp;tab make sure only the <b>src</b>&nbsp;folder is selected, since it is the only folder we are trying to get coverage on.<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-_KTqWyFMqGg/UWuQmzTylyI/AAAAAAAAAZo/BetoHb5C8rU/s1600/EvoSuite-Test.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="292" src="http://2.bp.blogspot.com/-_KTqWyFMqGg/UWuQmzTylyI/AAAAAAAAAZo/BetoHb5C8rU/s400/EvoSuite-Test.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">EvoSuite test coverage configuration.</td></tr></tbody></table><br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-pcfGCr46x9Q/UWuQpx6r8kI/AAAAAAAAAZ4/vcdSJtSMEbg/s1600/EvoSuite-Coverage.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="292" src="http://1.bp.blogspot.com/-pcfGCr46x9Q/UWuQpx6r8kI/AAAAAAAAAZ4/vcdSJtSMEbg/s400/EvoSuite-Coverage.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">EvoSuite coverage selection.</td></tr></tbody></table><br /><div class="separator" style="clear: both; text-align: center;"></div><br /><br /><div class="separator" style="clear: both; text-align: center;"></div>Randoop will be &nbsp;a bit more tricky because we have to create a coverage run for each class (EclEmma will allow us to combine these together later on to get a single coverage profile). &nbsp;It is probably best to create a sub folder in the Randoop folder for each class. &nbsp;Then right-click on the first sub-folder and go to <b>Coverage As -&gt; Coverage Configuration</b>&nbsp;again. &nbsp;This time you want to click <b>Run a single test</b>&nbsp;because if you try to run all tests in the folder it will run out of memory. &nbsp;However if you select just the test class without a number, then that one will call all of the other ones. &nbsp;If you try to run the entire folder than the tests get run twice and it overloads the JVM.<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-F6LQLwJCcUM/UWuQp0m0Y8I/AAAAAAAAAZ0/EXSfJmxyqnY/s1600/Randoop-Test.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="292" src="http://3.bp.blogspot.com/-F6LQLwJCcUM/UWuQp0m0Y8I/AAAAAAAAAZ0/EXSfJmxyqnY/s400/Randoop-Test.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Randoop test coverage configuration</td></tr></tbody></table>Now after you run each of the Randoop coverage tests it is quite easy to merge them together. &nbsp;Just select the <b>Merge Sessions</b>&nbsp;option in the <b>Coverage</b>&nbsp;window that opens at the bottom and select which ones you want merged. &nbsp;Then you will have a fair comparison between the two. &nbsp;The sad news is that you will have to use a calculator and add up all the JUnit times yourself so that you can figure out how long it took each to run.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-PSrAg0sbazk/UWuQpwuSlVI/AAAAAAAAAaE/eYVwKZ4n9vY/s1600/EclEmma_ScreenShot.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="364" src="http://1.bp.blogspot.com/-PSrAg0sbazk/UWuQpwuSlVI/AAAAAAAAAaE/eYVwKZ4n9vY/s640/EclEmma_ScreenShot.png" width="640" /></a></div><br />Hope this helps. Peace!</div>